# ä½œä¸šæ¨¡å—å‰åå°æ•°æ®è§„èŒƒå¯¹ç…§è¡¨

**åˆ›å»ºæ—¶é—´**: 2025-10-15  
**è§„èŒƒç‰ˆæœ¬**: v1.0

---

## 1. å­—æ®µå‘½åè§„èŒƒå¯¹ç…§è¡¨

### 1.1 Assignmentï¼ˆä½œä¸šè¡¨ï¼‰å­—æ®µ

| æ•°æ®åº“å­—æ®µ | PHPè®¿é—® | JavaScriptè®¿é—® | Voltæ¨¡æ¿è®¿é—® | æ•°æ®ç±»å‹ | è¯´æ˜ | âŒåºŸå¼ƒå­—æ®µ |
|-----------|---------|---------------|-------------|---------|------|----------|
| `max_score` | `$assignment->max_score` | `assignment.max_score` | `assignment.max_score` | decimal(10,2) | ä½œä¸šæ€»åˆ† | ~~`total_score`~~ |
| `due_date` | `$assignment->due_date` | `assignment.due_date` | `assignment.due_date` | int(11) | æˆªæ­¢æ—¶é—´(Unixæ—¶é—´æˆ³) | ~~`deadline`~~ |
| `allow_late` | `$assignment->allow_late` | `assignment.allow_late` | `assignment.allow_late` | tinyint(1) | æ˜¯å¦å…è®¸è¿Ÿäº¤(0/1) | ~~`allow_resubmit`~~ |
| `content` | `$assignment->getContentData()` | `assignment.content` | `assignment.content` | text(JSON) | ä½œä¸šé¢˜ç›®å†…å®¹ | ~~`questions`~~ |
| `grade_mode` | `$assignment->grade_mode` | `assignment.grade_mode` | `assignment.grade_mode` | varchar(20) | è¯„åˆ†æ¨¡å¼ | - |
| `rubric` | `$assignment->getRubricData()` | `assignment.rubric` | `assignment.rubric` | text(JSON) | è¯„åˆ†æ ‡å‡† | - |
| `attachments` | `$assignment->getAttachmentsData()` | `assignment.attachments` | `assignment.attachments` | text(JSON) | é™„ä»¶åˆ—è¡¨ | - |

### 1.2 AssignmentSubmissionï¼ˆä½œä¸šæäº¤è¡¨ï¼‰å­—æ®µ

| æ•°æ®åº“å­—æ®µ | PHPè®¿é—® | JavaScriptè®¿é—® | Voltæ¨¡æ¿è®¿é—® | æ•°æ®ç±»å‹ | è¯´æ˜ | âŒåºŸå¼ƒå­—æ®µ |
|-----------|---------|---------------|-------------|---------|------|----------|
| `content` | `$submission->getContentData()` | `submission.content` | `submission.content` | text(JSON) | å­¦ç”Ÿç­”æ¡ˆ | ~~`answers`~~ |
| `submit_time` | `$submission->submit_time` | `submission.submit_time` | `submission.submit_time` | int(11) | æäº¤æ—¶é—´ | ~~`submitted_at`~~ |
| `grade_time` | `$submission->grade_time` | `submission.grade_time` | `submission.grade_time` | int(11) | æ‰¹æ”¹æ—¶é—´ | ~~`graded_at`~~ |
| `grader_id` | `$submission->grader_id` | `submission.grader_id` | `submission.grader_id` | int(11) NULL | æ‰¹æ”¹äººID | - |
| `status` | `$submission->status` | `submission.status` | `submission.status` | varchar(20) | æäº¤çŠ¶æ€ | - |
| `grade_status` | `$submission->grade_status` | `submission.grade_status` | `submission.grade_status` | varchar(20) | æ‰¹æ”¹çŠ¶æ€ | - |
| `delete_time` | `$submission->delete_time` | `submission.delete_time` | `submission.delete_time` | int(11) | åˆ é™¤æ—¶é—´(è½¯åˆ é™¤) | ~~`deleted`~~ |

---

## 2. é¢˜ç›®æ•°æ®ç»“æ„è§„èŒƒ

### 2.1 Assignment.content ç»“æ„ï¼ˆé¢˜ç›®æ•°ç»„ï¼‰

**æ ‡å‡†æ ¼å¼**ï¼ˆç›´æ¥æ•°ç»„ï¼‰ï¼š
```json
[
  {
    "id": 1,
    "type": "choice",
    "title": "é¢˜ç›®æ ‡é¢˜",
    "score": 40,
    "multiple": false,
    "options": {
      "A": "é€‰é¡¹Aå†…å®¹",
      "B": "é€‰é¡¹Bå†…å®¹",
      "C": "é€‰é¡¹Cå†…å®¹",
      "D": "é€‰é¡¹Då†…å®¹"
    },
    "correct_answer": "A"
  },
  {
    "id": 2,
    "type": "choice",
    "title": "å¤šé€‰é¢˜ç¤ºä¾‹",
    "score": 30,
    "multiple": true,
    "options": {
      "A": "é€‰é¡¹A",
      "B": "é€‰é¡¹B",
      "C": "é€‰é¡¹C"
    },
    "correct_answer": ["A", "C"]
  },
  {
    "id": 3,
    "type": "essay",
    "title": "ç®€ç­”é¢˜ç¤ºä¾‹",
    "score": 30,
    "min_length": 50,
    "max_length": 500
  }
]
```

**å…¼å®¹æ ¼å¼**ï¼ˆæ—§ç‰ˆåŒ…è£¹åœ¨questionsé”®ä¸­ï¼‰ï¼š
```json
{
  "questions": [
    { "id": 1, "type": "choice", ... }
  ]
}
```

### 2.2 é¢˜ç›®ç±»å‹ï¼ˆtypeï¼‰æšä¸¾å€¼

| ç±»å‹å€¼ | è¯´æ˜ | æ˜¯å¦è‡ªåŠ¨è¯„åˆ† | å‰ç«¯ç»„ä»¶ç±»å‹ |
|-------|------|------------|------------|
| `choice` | é€‰æ‹©é¢˜ï¼ˆå•é€‰/å¤šé€‰ï¼Œé€šè¿‡multipleå­—æ®µåŒºåˆ†ï¼‰ | âœ… æ˜¯ | radio/checkbox |
| `essay` | ç®€ç­”é¢˜/æ–‡æœ¬é¢˜ | âŒ å¦ | textarea |
| `code` | ç¼–ç¨‹é¢˜ | âŒ å¦ | code editor |
| `file_upload` | æ–‡ä»¶ä¸Šä¼ é¢˜ | âŒ å¦ | file input |

âš ï¸ **é‡è¦**ï¼šå‰ç«¯ä¸å¾—ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹åå¦‚`radio`, `checkbox`, `text`ç­‰ã€‚

### 2.3 é¢˜ç›®å­—æ®µè¯¦ç»†è¯´æ˜

| å­—æ®µå | æ•°æ®ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|-------|---------|------|------|------|
| `id` | int/string | âœ… | é¢˜ç›®IDï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰ | `1` |
| `type` | string | âœ… | é¢˜ç›®ç±»å‹ | `"choice"` |
| `title` | string | âœ… | é¢˜ç›®æ ‡é¢˜ | `"ä»¥ä¸‹å“ªä¸ªæ˜¯PHPæ¡†æ¶ï¼Ÿ"` |
| `score` | number | âœ… | é¢˜ç›®åˆ†å€¼ | `40` |
| `multiple` | boolean | å½“type=choiceæ—¶å¿…å¡« | æ˜¯å¦å¤šé€‰ | `false` |
| `options` | object | å½“type=choiceæ—¶å¿…å¡« | é€‰é¡¹ï¼ˆå¯¹è±¡æ ¼å¼ï¼‰ | `{"A": "Laravel", "B": "Django"}` |
| `correct_answer` | string/array | é€‰æ‹©é¢˜å¿…å¡« | æ­£ç¡®ç­”æ¡ˆ | å•é€‰ï¼š`"A"` å¤šé€‰ï¼š`["A", "C"]` |
| `required` | boolean | âŒ | æ˜¯å¦å¿…ç­” | `true` |
| `min_length` | int | âŒ | æœ€å°å­—æ•°ï¼ˆç®€ç­”é¢˜ï¼‰ | `50` |
| `max_length` | int | âŒ | æœ€å¤§å­—æ•°ï¼ˆç®€ç­”é¢˜ï¼‰ | `500` |

---

## 3. å­¦ç”Ÿç­”æ¡ˆæ•°æ®ç»“æ„è§„èŒƒ

### 3.1 AssignmentSubmission.content ç»“æ„

**æ ‡å‡†æ ¼å¼**ï¼ˆé¢˜ç›®ID â†’ ç­”æ¡ˆå€¼ï¼‰ï¼š
```json
{
  "1": "A",
  "2": ["A", "C"],
  "3": "è¿™æ˜¯å­¦ç”Ÿçš„ç®€ç­”é¢˜ç­”æ¡ˆå†…å®¹..."
}
```

### 3.2 ä¸åŒé¢˜å‹çš„ç­”æ¡ˆæ ¼å¼è§„èŒƒ

| é¢˜ç›®ç±»å‹ | ç­”æ¡ˆæ•°æ®ç±»å‹ | æ ¼å¼ç¤ºä¾‹ | âœ…æ­£ç¡® | âŒé”™è¯¯ |
|---------|------------|---------|-------|-------|
| å•é€‰é¢˜ (choice + multiple=false) | **å­—ç¬¦ä¸²** | `"A"` | `{"1": "A"}` | `{"1": ["A"]}` |
| å¤šé€‰é¢˜ (choice + multiple=true) | **æ•°ç»„** | `["A", "C"]` | `{"2": ["A", "C"]}` | `{"2": "A,C"}` |
| ç®€ç­”é¢˜ (essay) | **å­—ç¬¦ä¸²** | `"å­¦ç”Ÿç­”æ¡ˆ..."` | `{"3": "..."}` | `{"3": null}` |
| ç¼–ç¨‹é¢˜ (code) | **å­—ç¬¦ä¸²** | `"<?php ..."` | `{"4": "..."}` | - |
| æ–‡ä»¶ä¸Šä¼  (file_upload) | **å­—ç¬¦ä¸²**ï¼ˆæ–‡ä»¶è·¯å¾„ï¼‰ | `"/uploads/xxx.pdf"` | `{"5": "/uploads/..."}` | - |

âš ï¸ **å…³é”®è§„åˆ™**ï¼š
1. **å•é€‰é¢˜ç­”æ¡ˆå¿…é¡»æ˜¯å­—ç¬¦ä¸²**ï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªé€‰é¡¹ä¹Ÿä¸èƒ½ç”¨æ•°ç»„
2. **å¤šé€‰é¢˜ç­”æ¡ˆå¿…é¡»æ˜¯æ•°ç»„**ï¼Œå³ä½¿åªé€‰äº†ä¸€ä¸ªé€‰é¡¹ä¹Ÿå¿…é¡»ç”¨æ•°ç»„åŒ…è£¹
3. **é¢˜ç›®IDä½œä¸ºkeyæ—¶ç»Ÿä¸€ä½¿ç”¨å­—ç¬¦ä¸²**ï¼š`{"1": "A"}` è€Œä¸æ˜¯ `{1: "A"}`

---

## 4. è‡ªåŠ¨è¯„åˆ†è§„åˆ™

### 4.1 å¯è‡ªåŠ¨è¯„åˆ†çš„é¢˜å‹

| é¢˜å‹ | æ˜¯å¦è‡ªåŠ¨è¯„åˆ† | è¯„åˆ†ç®—æ³• |
|------|------------|---------|
| å•é€‰é¢˜ | âœ… æ˜¯ | å­—ç¬¦ä¸²ä¸¥æ ¼ç›¸ç­‰æ¯”è¾ƒ |
| å¤šé€‰é¢˜ | âœ… æ˜¯ | æ•°ç»„å®Œå…¨åŒ¹é…ï¼ˆæ’åºåæ¯”è¾ƒï¼‰|
| ç®€ç­”é¢˜ | âŒ å¦ | å¿…é¡»äººå·¥æ‰¹æ”¹ |
| ç¼–ç¨‹é¢˜ | âŒ å¦ | å¿…é¡»äººå·¥æ‰¹æ”¹ |
| æ–‡ä»¶ä¸Šä¼ é¢˜ | âŒ å¦ | å¿…é¡»äººå·¥æ‰¹æ”¹ |

### 4.2 å•é€‰é¢˜è¯„åˆ†ç®—æ³•

```php
// å­¦ç”Ÿç­”æ¡ˆç±»å‹ï¼šå­—ç¬¦ä¸²ï¼ˆå¦‚ "A"ï¼‰
// æ­£ç¡®ç­”æ¡ˆç±»å‹ï¼šå­—ç¬¦ä¸²ï¼ˆå¦‚ "A"ï¼‰
$userAnswer = "A"; // å­—ç¬¦ä¸²
$correctAnswer = "A"; // å­—ç¬¦ä¸²

if ($userAnswer === $correctAnswer) {
    $score = $question['score']; // å¾—æ»¡åˆ†
} else {
    $score = 0;
}
```

### 4.3 å¤šé€‰é¢˜è¯„åˆ†ç®—æ³•

```php
// å­¦ç”Ÿç­”æ¡ˆç±»å‹ï¼šæ•°ç»„ï¼ˆå¦‚ ["A", "C"]ï¼‰
// æ­£ç¡®ç­”æ¡ˆç±»å‹ï¼šæ•°ç»„ï¼ˆå¦‚ ["A", "C"]ï¼‰
$userAnswer = ["A", "C"]; // æ•°ç»„
$correctAnswer = ["A", "C"]; // æ•°ç»„

// æ’åºåæ¯”è¾ƒï¼ˆé¡ºåºæ— å…³ï¼‰
sort($userAnswer);
sort($correctAnswer);

if ($userAnswer === $correctAnswer) {
    $score = $question['score']; // å¾—æ»¡åˆ†
} else {
    $score = 0; // ä¸æ”¯æŒéƒ¨åˆ†å¾—åˆ†
}
```

âš ï¸ **æ³¨æ„**ï¼šå¤šé€‰é¢˜ä¸æ”¯æŒéƒ¨åˆ†å¾—åˆ†ï¼Œå¿…é¡»å…¨éƒ¨é€‰å¯¹æ‰å¾—åˆ†ã€‚

---

## 5. æäº¤çŠ¶æ€ç®¡ç†è§„èŒƒ

### 5.1 çŠ¶æ€å­—æ®µç»„åˆ

AssignmentSubmission ä½¿ç”¨ä¸¤ä¸ªå­—æ®µç®¡ç†çŠ¶æ€ï¼š

| status | grade_status | å«ä¹‰ | å‰ç«¯æ˜¾ç¤º | æ“ä½œæŒ‰é’® |
|--------|-------------|------|---------|---------|
| `draft` | `pending` | è‰ç¨¿ | "è‰ç¨¿" | "ç»§ç»­ç¼–è¾‘" |
| `submitted` | `pending` | å·²æäº¤ï¼Œç­‰å¾…æ‰¹æ”¹ | "å·²æäº¤" | "ç­‰å¾…æ‰¹æ”¹" |
| `graded` | `pending` | æ‰¹æ”¹ä¸­ï¼ˆmixedæ¨¡å¼ï¼Œéƒ¨åˆ†æ‰¹æ”¹ï¼‰ | "æ‰¹æ”¹ä¸­" | æ˜¾ç¤ºå·²æ‰¹æ”¹éƒ¨åˆ†åˆ†æ•° |
| `graded` | `completed` | å·²æ‰¹æ”¹å®Œæˆ | "å·²æ‰¹æ”¹" | "æŸ¥çœ‹æˆç»©" |
| `returned` | `completed` | å·²é€€å› | "å·²é€€å›" | "é‡æ–°æäº¤" |

### 5.2 æ‰¹æ”¹æ¨¡å¼ä¸grader_idè®¾ç½®

| grade_mode | æ‰¹æ”¹æ–¹å¼ | grader_id | grade_statusï¼ˆæäº¤åï¼‰ | è¯´æ˜ |
|-----------|---------|-----------|---------------------|------|
| `auto` | çº¯è‡ªåŠ¨æ‰¹æ”¹ | `NULL` âš ï¸ | `completed` | æäº¤å³å®Œæˆæ‰¹æ”¹ |
| `manual` | çº¯æ‰‹åŠ¨æ‰¹æ”¹ | `assignment.owner_id` | `pending` | ç­‰å¾…æ•™å¸ˆæ‰¹æ”¹ |
| `mixed` | æ··åˆæ‰¹æ”¹ | `assignment.owner_id` | `pending` | é€‰æ‹©é¢˜å·²è‡ªåŠ¨è¯„åˆ†ï¼Œä¸»è§‚é¢˜ç­‰å¾…æ‰¹æ”¹ |

âš ï¸ **é‡è¦**ï¼š`auto`æ¨¡å¼ä¸‹`grader_id`å¿…é¡»ä¸º`NULL`ï¼Œä¸èƒ½ä¸º`0`ï¼Œå¦åˆ™è§¦å‘å¤–é”®çº¦æŸé”™è¯¯ã€‚

---

## 6. å‰ç«¯æ•°æ®ä¼ é€’è§„èŒƒ

### 6.1 æ—¥æœŸæ—¶é—´æ ¼å¼è½¬æ¢

| åœºæ™¯ | å‰ç«¯è¾“å…¥ | è½¬æ¢å | åç«¯å­˜å‚¨ |
|------|---------|-------|---------|
| æäº¤æˆªæ­¢æ—¶é—´ | `"2025-10-20 23:59:00"` | `Math.floor(new Date(dateStr).getTime() / 1000)` | `1729440000` (Unixæ—¶é—´æˆ³) |
| å‘å¸ƒæ—¶é—´ | `"2025-10-15 10:00:00"` | åŒä¸Š | Unixæ—¶é—´æˆ³ |

### 6.2 å¤é€‰æ¡†å€¼è½¬æ¢

| å­—æ®µ | å‰ç«¯å‹¾é€‰ | å‰ç«¯æœªå‹¾é€‰ | åç«¯æ¥æ”¶ |
|------|---------|-----------|---------|
| `allow_late` | `1` (æ•´æ•°) | `0` (æ•´æ•°) | tinyint(1) |

âŒ **ç¦æ­¢**ä½¿ç”¨å¸ƒå°”å€¼`true`/`false`æˆ–å­—ç¬¦ä¸²`"on"`/`"off"`

### 6.3 JSONæ•°æ®ä¼ é€’åˆ°Voltæ¨¡æ¿

âŒ **é”™è¯¯æ–¹å¼**ï¼ˆä¼šè¢«HTMLå®ä½“ç¼–ç ï¼‰ï¼š
```html
<input type="hidden" value="{{ assignment|json_encode }}">
```

âœ… **æ­£ç¡®æ–¹å¼**ï¼š
```html
<script type="application/json" id="assignment-data">
{{ assignment|json_encode }}
</script>
```

JavaScriptè·å–ï¼š
```javascript
var raw = document.getElementById('assignment-data').textContent;
var data = JSON.parse(raw);
```

---

## 7. å‘ç°çš„é—®é¢˜æ¸…å•

### ğŸ”´ éœ€è¦ä¿®å¤çš„é—®é¢˜

| æ–‡ä»¶ | è¡Œå· | é—®é¢˜æè¿° | ä¿®å¤æ–¹æ¡ˆ |
|------|-----|---------|---------|
| `app/Http/Admin/Controllers/AssignmentController.php` | 768, 867, 920, 963 | ä½¿ç”¨äº†`total_score`ä½œä¸ºè¿”å›å€¼key | æ”¹ä¸º`max_score` |
| `app/Services/Logic/Assignment/AutoGrade.php` | 115-117 | å•é€‰é¢˜correct_answerå‡è®¾ä¸ºæ•°ç»„ | æ”¹ä¸ºå­—ç¬¦ä¸²æ¯”è¾ƒ |
| `public/static/home/js/assignment.show.js` | 9 | å˜é‡å`deadline`å¯æ”¹ä¸º`dueDate`ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰ | æœ¬åœ°å˜é‡ï¼Œå½±å“ä¸å¤§ |

### âœ… å·²ç¬¦åˆè§„èŒƒçš„éƒ¨åˆ†

- âœ… Modelså±‚å­—æ®µåå…¨éƒ¨è§„èŒƒ
- âœ… Serviceså±‚å¤§éƒ¨åˆ†ä»£ç ä½¿ç”¨æ ‡å‡†å­—æ®µå
- âœ… JSONå­—æ®µéƒ½é€šè¿‡Getter/Setteræ–¹æ³•è®¿é—®
- âœ… é¢˜ç›®è§£æé€»è¾‘å…¼å®¹æ–°æ—§ä¸¤ç§æ ¼å¼
- âœ… çŠ¶æ€ç®¡ç†é€»è¾‘æ¸…æ™°

---

## 8. ä»£ç ä¿®æ”¹ä¼˜å…ˆçº§

### P0 - å¿…é¡»ä¿®å¤ï¼ˆå½±å“åŠŸèƒ½ï¼‰
1. **AutoGrade.phpå•é€‰é¢˜è¯„åˆ†é€»è¾‘** - ä¼šå¯¼è‡´è¯„åˆ†é”™è¯¯
2. **AssignmentController.phpçš„total_score** - è™½ç„¶åªæ˜¯è¿”å›å€¼keyï¼Œä½†ä¸ºäº†è§„èŒƒç»Ÿä¸€

### P1 - å»ºè®®ä¿®å¤ï¼ˆæå‡è§„èŒƒæ€§ï¼‰
1. ç»Ÿä¸€å‰ç«¯å˜é‡å‘½åé£æ ¼
2. æ·»åŠ æ›´å¤šé”™è¯¯å¤„ç†å’Œæ—¥å¿—

### P2 - ä¼˜åŒ–é¡¹ï¼ˆæ€§èƒ½å’Œä½“éªŒï¼‰
1. æ·»åŠ å¿…è¦çš„æ•°æ®åº“ç´¢å¼•
2. ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
3. æ·»åŠ ç¼“å­˜ç­–ç•¥

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-15  
**å®¡æŸ¥äºº**: AI Assistant


