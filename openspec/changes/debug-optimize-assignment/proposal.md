# Debug and Optimize Assignment Module

## Why

ä½œä¸šæ¨¡å—åœ¨å‰æœŸå¼€å‘ä¸­ç»å†äº†25æ¬¡ä¿®å¤ï¼Œä¸»è¦é—®é¢˜æ˜¯**å­—æ®µå‘½åä¸ç»Ÿä¸€**å¯¼è‡´çš„å„ç§bugï¼ˆå¦‚`total_score` vs `max_score`ã€`deadline` vs `due_date`ç­‰ï¼‰ã€‚è™½ç„¶å·²ç»åˆ›å»ºäº†å­—æ®µè§„èŒƒæ–‡æ¡£ï¼Œä½†ç°æœ‰ä»£ç ä¸­ä»å¯èƒ½å­˜åœ¨ï¼š

1. **é—ç•™çš„æ—§å­—æ®µåè°ƒç”¨**ï¼šéƒ¨åˆ†Serviceã€Controllerã€Viewå¯èƒ½ä»åœ¨ä½¿ç”¨åºŸå¼ƒå­—æ®µ
2. **æ•°æ®ä¸ä¸€è‡´é—®é¢˜**ï¼šJSONå­—æ®µå¤„ç†ä¸è§„èŒƒã€çŠ¶æ€å­—æ®µä½¿ç”¨æ··ä¹±
3. **æ½œåœ¨çš„è¿é”bug**ï¼šå­—æ®µåä¸ç»Ÿä¸€å¯¼è‡´çš„æ•°æ®æ— æ³•æ­£ç¡®è¯»å†™
4. **ä»£ç è´¨é‡é—®é¢˜**ï¼šé‡å¤ä»£ç ã€ç¼ºå°‘é”™è¯¯å¤„ç†ã€æ³¨é‡Šä¸è¶³

æœ¬æ¬¡å˜æ›´æ—¨åœ¨**ç³»ç»Ÿæ€§åœ°æ’æŸ¥å’Œä¼˜åŒ–**ä½œä¸šæ¨¡å—ï¼Œç¡®ä¿ï¼š
- æ‰€æœ‰ä»£ç ç»Ÿä¸€ä½¿ç”¨æ ‡å‡†å­—æ®µå
- JSONå­—æ®µå¤„ç†è§„èŒƒ
- çŠ¶æ€ç®¡ç†é€»è¾‘æ¸…æ™°
- ä»£ç è´¨é‡è¾¾æ ‡

## What Changes

### ğŸ”´ **å·¥ä½œåŸåˆ™** 
- âš ï¸ **å…ˆè§„èŒƒï¼Œåç¼–ç **ï¼šå¿…é¡»å…ˆå®Œæˆå‰åå°è§„èŒƒç»Ÿä¸€å®¡æŸ¥ï¼Œç¡®ä¿æ‰€æœ‰è§„èŒƒæ˜ç¡®åå†å¼€å§‹ä»£ç ä¿®æ”¹
- âš ï¸ **çº¿ä¸Šæµ‹è¯•**ï¼šé¡¹ç›®éƒ¨ç½²åœ¨æœåŠ¡å™¨ï¼Œéœ€è¦Gitæäº¤ååœ¨çº¿ä¸Šæµ‹è¯•
- âš ï¸ **è°¨æ…æäº¤**ï¼šæ¯æ¬¡æäº¤å‰å……åˆ†å®¡æŸ¥ï¼Œé¿å…é¢‘ç¹æäº¤-æµ‹è¯•å¾ªç¯

### 1. å‰åå°è§„èŒƒç»Ÿä¸€å®¡æŸ¥ âœ… **ç¬¬ä¸€ä¼˜å…ˆçº§ - å¿…é¡»å…ˆå®Œæˆ**
- [ ] å®¡æŸ¥å’Œæ–‡æ¡£åŒ–é¢˜ç›®æ•°æ®ç»“æ„ï¼ˆ`Assignment.content`ï¼‰
- [ ] å®¡æŸ¥å’Œæ–‡æ¡£åŒ–ç­”æ¡ˆæ•°æ®ç»“æ„ï¼ˆ`AssignmentSubmission.content`ï¼‰
- [ ] ç»Ÿä¸€å‰ç«¯å‚æ•°å‘½åï¼ˆç¦æ­¢é©¼å³°ï¼Œä½¿ç”¨snake_caseï¼‰
- [ ] ç»Ÿä¸€åç«¯å‚æ•°å‘½åï¼ˆåºŸå¼ƒå­—æ®µå…¨éƒ¨æ›¿æ¢ï¼‰
- [ ] ç»Ÿä¸€é¢˜ç›®è§£æé€»è¾‘ï¼ˆå…¼å®¹æ–°æ—§æ ¼å¼ï¼‰
- [ ] æ˜ç¡®è‡ªåŠ¨è¯„åˆ†è§„åˆ™ï¼ˆåªå¯¹é€‰æ‹©é¢˜æœ‰æ•ˆï¼Œå•é€‰/å¤šé€‰å·®å¼‚ï¼‰
- [ ] è¾“å‡ºå‰åå°æ•°æ®è§„èŒƒå¯¹ç…§è¡¨

### 2. ä»£ç å®¡è®¡ä¸å­—æ®µç»Ÿä¸€ âœ… **æ ¸å¿ƒä»»åŠ¡**
- [ ] å®¡è®¡æ‰€æœ‰ä½œä¸šç›¸å…³çš„Modelã€Repoã€Serviceã€Controllerã€View
- [ ] å°†æ‰€æœ‰åºŸå¼ƒå­—æ®µæ›¿æ¢ä¸ºæ ‡å‡†å­—æ®µï¼š
  - ~~`total_score`~~ â†’ `max_score`
  - ~~`deadline`~~ â†’ `due_date`
  - ~~`allow_resubmit`~~ â†’ `allow_late`
  - ~~`answers`~~ â†’ `content`
  - ~~`submitted_at`~~ â†’ `submit_time`
  - ~~`graded_at`~~ â†’ `grade_time`
  - ~~`deleted`~~ â†’ `delete_time > 0`
- [ ] ç¡®ä¿æ‰€æœ‰JSONå­—æ®µä½¿ç”¨`setXxxData()`/`getXxxData()`æ–¹æ³•

### 3. è‡ªåŠ¨è¯„åˆ†è§„åˆ™ä¼˜åŒ– âš ï¸ **é‡è¦è°ƒæ•´**
- [ ] **åªå¯¹é€‰æ‹©é¢˜ï¼ˆå•é€‰+å¤šé€‰ï¼‰è¿›è¡Œè‡ªåŠ¨è¯„åˆ†**
- [ ] ç®€ç­”é¢˜ï¼ˆ`essay`ï¼‰ç¦æ­¢è‡ªåŠ¨è¯„åˆ†ï¼Œå¿…é¡»äººå·¥æ‰¹æ”¹
- [ ] ç¼–ç¨‹é¢˜ï¼ˆ`code`ï¼‰ç¦æ­¢è‡ªåŠ¨è¯„åˆ†ï¼Œå¿…é¡»äººå·¥æ‰¹æ”¹
- [ ] æ–‡ä»¶ä¸Šä¼ é¢˜ï¼ˆ`file_upload`ï¼‰ç¦æ­¢è‡ªåŠ¨è¯„åˆ†ï¼Œå¿…é¡»äººå·¥æ‰¹æ”¹
- [ ] å•é€‰é¢˜å’Œå¤šé€‰é¢˜è¯„åˆ†é€»è¾‘å·®å¼‚ï¼š
  - å•é€‰é¢˜ï¼šç­”æ¡ˆç±»å‹ä¸ºå­—ç¬¦ä¸² `"A"`ï¼Œä¸¥æ ¼ç›¸ç­‰æ¯”è¾ƒ
  - å¤šé€‰é¢˜ï¼šç­”æ¡ˆç±»å‹ä¸ºæ•°ç»„ `["A", "C"]`ï¼Œæ•°ç»„å®Œå…¨ç›¸ç­‰æ¯”è¾ƒ
  - å¤šé€‰é¢˜ä¸æ”¯æŒéƒ¨åˆ†å¾—åˆ†

### 4. JSONå­—æ®µå¤„ç†è§„èŒƒåŒ–
- [ ] å®¡è®¡æ‰€æœ‰JSONå­—æ®µçš„è¯»å†™æ“ä½œ
- [ ] ç¡®ä¿ç©ºJSONå­—æ®µåˆå§‹åŒ–ä¸º`[]`è€Œä¸æ˜¯`''`æˆ–`null`
- [ ] é¿å…`toArray()`åé‡å¤`json_decode()`

### 5. çŠ¶æ€ç®¡ç†ä¼˜åŒ–
- [ ] ç»Ÿä¸€`status`å’Œ`grade_status`çš„ä½¿ç”¨é€»è¾‘
- [ ] ç¡®ä¿æ‰¹æ”¹æ¨¡å¼ï¼ˆauto/manual/mixedï¼‰æ­£ç¡®è®¾ç½®`grader_id`
- [ ] å‰ç«¯çŠ¶æ€æ˜¾ç¤ºé€»è¾‘ä¼˜åŒ–ï¼ˆåŒºåˆ†"æ‰¹æ”¹ä¸­"å’Œ"å·²æ‰¹æ”¹"ï¼‰

### 6. é”™è¯¯å¤„ç†ä¸æ—¥å¿—
- [ ] æ·»åŠ å…³é”®æ“ä½œçš„é”™è¯¯å¤„ç†
- [ ] æ·»åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- [ ] æ·»åŠ æ•°æ®éªŒè¯å¤±è´¥çš„å‹å¥½æç¤º

### 7. ä»£ç ä¼˜åŒ–ä¸é‡æ„
- [ ] æ¶ˆé™¤é‡å¤ä»£ç 
- [ ] æ·»åŠ å¿…è¦çš„ä»£ç æ³¨é‡Š
- [ ] ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼ˆæ·»åŠ ç´¢å¼•ã€å‡å°‘N+1æŸ¥è¯¢ï¼‰

### 8. åˆ›å»ºè§„èŒƒæ–‡æ¡£
- [ ] ä¸ºä½œä¸šæ¨¡å—åˆ›å»ºOpenSpecè§„èŒƒï¼ˆ`specs/assignment/spec.md`ï¼‰
- [ ] è®°å½•æ‰€æœ‰ä¸šåŠ¡è§„åˆ™å’Œæ•°æ®ç»“æ„
- [ ] ä½œä¸ºæœªæ¥å¼€å‘çš„å‚è€ƒæ ‡å‡†

## Impact

### å½±å“çš„Capabilities
- **assignment** - æ–°å¢OpenSpecè§„èŒƒï¼ˆç›®å‰ä¸å­˜åœ¨ï¼‰

### å½±å“çš„ä»£ç æ–‡ä»¶

#### æ ¸å¿ƒModels (2ä¸ª)
- `app/Models/Assignment.php`
- `app/Models/AssignmentSubmission.php`

#### Repositories (2ä¸ª)
- `app/Repos/Assignment.php`
- `app/Repos/AssignmentSubmission.php`

#### Services (10+ä¸ª)
- `app/Services/Logic/Assignment/AssignmentSubmit.php`
- `app/Services/Logic/Assignment/SubmissionDraft.php`
- `app/Services/Logic/Assignment/AutoGrade.php`
- `app/Services/Logic/Assignment/AssignmentInfo.php`
- `app/Services/Logic/Assignment/SubmissionResult.php`
- `app/Services/Logic/Assignment/AssignmentList.php` (Admin)
- `app/Services/Logic/Course/AssignmentList.php` (å‰å°è¯¾ç¨‹ä½œä¸šåˆ—è¡¨)
- `app/Services/Logic/User/Console/AssignmentList.php` (ä¸ªäººä¸­å¿ƒ)
- `app/Services/Logic/Notice/Internal/AssignmentPublished.php`
- `app/Services/Logic/Notice/Internal/AssignmentGraded.php`

#### Controllers (3ä¸ª)
- `app/Http/Admin/Controllers/AssignmentController.php`
- `app/Http/Admin/Controllers/AssignmentSubmissionController.php`
- `app/Http/Home/Controllers/AssignmentController.php`

#### Validators (5+ä¸ª)
- `app/Validators/Assignment*.php` (æ‰€æœ‰ä½œä¸šç›¸å…³éªŒè¯å™¨)

#### Views (10+ä¸ª)
- `app/Http/Admin/Views/assignment/*.volt`
- `app/Http/Home/Views/assignment/*.volt`
- `app/Http/Home/Views/course/assignments.volt`
- `app/Http/Home/Views/user/console/assignments.volt`

#### JavaScript (3+ä¸ª)
- `public/static/admin/js/assignment.*.js`
- `public/static/home/js/assignment.*.js`

### é¢„æœŸæ”¶ç›Š
1. **ç¨³å®šæ€§æå‡** - æ¶ˆé™¤å­—æ®µä¸ä¸€è‡´å¯¼è‡´çš„æ½œåœ¨bug
2. **å¯ç»´æŠ¤æ€§æå‡** - ä»£ç è§„èŒƒç»Ÿä¸€ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
3. **å¼€å‘æ•ˆç‡æå‡** - æœ‰æ˜ç¡®çš„è§„èŒƒæ–‡æ¡£ä½œä¸ºå‚è€ƒ
4. **ç”¨æˆ·ä½“éªŒæå‡** - é”™è¯¯æç¤ºæ›´å‹å¥½ï¼ŒçŠ¶æ€æ˜¾ç¤ºæ›´æ¸…æ™°

### é£é™©è¯„ä¼°
- **ä½é£é™©** - ä¸»è¦æ˜¯ä»£ç å®¡è®¡å’Œå­—æ®µåæ›¿æ¢ï¼Œä¸æ”¹å˜ä¸šåŠ¡é€»è¾‘
- **æµ‹è¯•è¦†ç›–** - éœ€è¦å®Œæ•´çš„å›å½’æµ‹è¯•ï¼ˆåˆ›å»ºã€ç¼–è¾‘ã€æäº¤ã€æ‰¹æ”¹ã€æŸ¥çœ‹æˆç»©ï¼‰
- **å›æ»šæ–¹æ¡ˆ** - Gitç‰ˆæœ¬æ§åˆ¶ï¼Œå¯å¿«é€Ÿå›æ»š

---

**ææ¡ˆåˆ›å»ºæ—¶é—´**: 2025-10-15  
**é¢„è®¡å®Œæˆæ—¶é—´**: 1-2å¤©  
**ä¼˜å…ˆçº§**: é«˜ âš ï¸

